{% extends 'produkty/base.html' %}

{% block title %}Podsumowanie Sprzedaży{% endblock %}

{% block content %}
<h1>Podsumowanie Sprzedaży</h1>

<div class="filter-container">
    <h3>Filtruj sprzedaż:</h3>
    <div class="month-navigation">
        <a href="?data_od={{ prev_month_data_od }}&data_do={{ prev_month_data_do }}" class="btn-month-nav">&laquo; Poprzedni</a>
        <span class="current-month">{{ data_od|date:"F Y" }}</span>
        <a href="?data_od={{ next_month_data_od }}&data_do={{ next_month_data_do }}" class="btn-month-nav">Następny &raquo;</a>
    </div>

    <form method="get" action="" class="filter-form">
        <div class="form-group">
            <label for="data_od">Data od:</label>
            <input type="date" name="data_od" id="data_od" value="{{ data_od }}">
        </div>
        <div class="form-group">
            <label for="data_do">Data do:</label>
            <input type="date" name="data_do" id="data_do" value="{{ data_do }}">
        </div>
        <div class="form-group">
            <label for="produkt">Produkt:</label>
            <input type="text" name="produkt" id="produkt" placeholder="Wpisz nazwę produktu" value="{{ produkt }}">
        </div>
        <div class="form-group">
            <label for="marka">Marka:</label>
            <input type="text" name="marka" id="marka" placeholder="Wpisz nazwę marki" value="{{ marka }}">
        </div>
        <div class="form-group">
            <button type="submit">Filtruj</button>
        </div>
    </form>
</div>

<div style="margin-bottom: 20px;">
    <form method="post" action="{% url 'produkty:reset_sprzedaz' %}" style="display: inline;" onsubmit="return confirm('Czy na pewno chcesz zresetować wszystkie dane sprzedaży?');">
        {% csrf_token %}
        <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
            Resetuj wszystkie dane
        </button>
    </form>
</div>

<p><strong>Liczba sprzedanych sztuk:</strong> {{ liczba_sztuk }}</p>
<p><strong>Całkowita prowizja:</strong> {{ calkowita_prowizja }} PLN</p>

<h2>Sprzedane produkty:</h2>
<table>
    <thead>
        <tr>
            <th>Marka</th>
            <th>Model</th>
            <th>Liczba sztuk</th>
            <th>Stawka (z mnożnikiem)</th>
            <th>Suma prowizji</th>
        </tr>
    </thead>
    <tbody>
        {% for s in sprzedaz %}
        <tr>
            <td>{{ s.produkt__marka }}</td>
            <td>{{ s.produkt__model }}</td>
            <td>{{ s.liczba_sztuk }}</td>
            <td>{{ s.produkt__stawka }} PLN</td>
            <td>{{ s.suma_prowizji }} PLN</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if task_rewards %}
<h2>Rozliczenia zadań</h2>
<table>
    <thead>
        <tr>
            <th>Zadanie</th>
            <th>Sprzedane sztuki</th>
            <th>Premia</th>
        </tr>
    </thead>
    <tbody>
        {% for r in task_rewards %}
        <tr>
            <td>{{ r.nazwa }}</td>
            <td>{{ r.sprzedane }}</td>
            <td>{{ r.premia }} PLN</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
